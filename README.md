## Telegram TaskTracker Bot

–ë–æ—Ç –¥–ª—è —Å–±–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–¥–∞—á –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö, –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑ –≤ —á–∞—Å —á–µ—Ä–µ–∑ GPT-5 –∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1. –°–æ–∑–¥–∞–π –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
   - macOS/Linux: `python3 -m venv .venv && source .venv/bin/activate`
   - Windows: `py -3 -m venv .venv && .venv\\Scripts\\activate`
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - `pip install -r requirements.txt`
3. –°–æ–∑–¥–∞–π `.env` –ø–æ –ø—Ä–∏–º–µ—Ä—É `.env.example`

### –ó–∞–ø—É—Å–∫
```
python main.py
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `OPENAI_API_KEY` ‚Äî –∫–ª—é—á OpenAI
- `GPT_MODEL` ‚Äî –º–æ–¥–µ–ª—å OpenAI, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- `TIMEZONE` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Europe/Moscow)
- `DAILY_REPORT_TIME` ‚Äî –≤—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞, —Ñ–æ—Ä–º–∞—Ç HH:MM (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 09:00)
- `DATABASE_PATH` ‚Äî –ø—É—Ç—å –∫ SQLite –±–∞–∑–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ./data/bot.db)
‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets:
- `GSHEET_SPREADSHEET_ID` ‚Äî ID —Ç–∞–±–ª–∏—Ü—ã (–∏–∑ URL –º–µ–∂–¥—É /d/ –∏ /edit)
- `GSHEET_WORKSHEET_NAME` ‚Äî –∏–º—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `Main`)
- `GSHEET_TASKS_WORKSHEET_NAME` ‚Äî –∏–º—è –ª–∏—Å—Ç–∞ –¥–ª—è –∑–∞–¥–∞—á (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `Tasks`)
- `GOOGLE_SERVICE_ACCOUNT_JSON_PATH` ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ JSON‚Äë–∫–ª—é—á—É —Å–µ—Ä–≤–∏—Å‚Äë–∞–∫–∫–∞—É–Ω—Ç–∞ –ò–õ–ò —Å–∞–º JSON –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π
  

### Docker
–ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ:
```
docker compose up --build
```

### –î–æ–∫–ø–ª–æ–π (Dokploy)
- –°–æ–∑–¥–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Dockerfile –∏–ª–∏ Compose)
- –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü–æ–¥–∫–ª—é—á–∏ volume –¥–ª—è `/app/data`

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- `/tasks [page]` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (20 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
- `/process_now` ‚Äî —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —á–∞—Å–∞ (—Ç–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
- `/parse <days>` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π (—Ç–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
- `/prioritize` ‚Äî –ø—Ä–∏—Å–ª–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ –≤—Å–µ–º –∑–∞–¥–∞—á–∞–º, –æ–∂–∏–¥–∞—é—â–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π**: —Ç–µ–∫—Å—Ç –∏–∑ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `raw_messages`; —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ `config/staff_list.py` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.
- **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (GPT)**: —Ä–∞–∑ –≤ —á–∞—Å –±–µ—Ä—É—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å, –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ GPT; –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `processed_tasks`, –∏—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–º–µ—á–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏. –ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —Å—Ç–∞–≤–∏—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å `pending_prioritization` –∏ –≤ —á–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω–ª–∞–π–Ω‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.
- **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: –Ω–∞–∂–∏–º–∞—Ç—å –∏–Ω–ª–∞–π–Ω‚Äë–∫–Ω–æ–ø–∫–∏ –º–æ–≥—É—Ç –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∑–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Google Sheets (—Å–º. –Ω–∏–∂–µ), –∑–∞–ø–∏—Å—å –≤ `pending_prioritization` —É–¥–∞–ª—è–µ—Ç—Å—è. –ö–æ–º–∞–Ω–¥–∞ `/prioritize` –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –∂–¥—É—Ç –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞. –í –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´–£–¥–∞–ª–∏—Ç—å¬ª ‚Äî —É–¥–∞–ª—è–µ—Ç –∑–∞–¥–∞—á—É —Ç–æ–ª—å–∫–æ –∏–∑ –ë–î (–∏–∑ Google Sheets –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è).
- **–õ–∏–º–∏—Ç –≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á**: –µ—Å–ª–∏ —Å—É–º–º–∞—Ä–Ω–æ –∑–∞–¥–∞—á —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ `Critical|Blocker|High` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è > 10, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–Ω–∏–∂–∞–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ø–æ—Å–ª–µ–¥–Ω–µ–π (LIFO) –¥–æ `Medium` –≤ Google Sheets.
- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã**: –≤ `DAILY_REPORT_TIME` –ø–æ `TIMEZONE` –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–∫—É –∑–∞–¥–∞—á –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å –≤ –∫–∞–∂–¥—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç.
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram**: –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—å—é—Ç—Å—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞, graceful shutdown.
- `bot/handlers.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤, `/tasks`, `/process_now`, `/parse`, `/prioritize`, –∫–æ–ª–ª–±—ç–∫–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞/—É–¥–∞–ª–µ–Ω–∏—è.
- `bot/scheduler.py` ‚Äî –µ–∂–µ—á–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã; –ø–æ–∫–∞–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.
- `bot/gpt_processor.py` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –≤—ã–∑–æ–≤ OpenAI —Å retry (exponential backoff).
- `database/models.py` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SQLite, –∏–Ω–¥–µ–∫—Å—ã.
- `database/operations.py` ‚Äî CRUD –∏ –≤—ã–±–æ—Ä–∫–∏; –æ—á–µ—Ä–µ–¥–∏ `pending_prioritization` –∏ –∑–∞–¥–∞—á–∏ `processed_tasks`.
- `utils/formatters.py` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –∑–∞–¥–∞—á –∏ –æ—Ç—á–µ—Ç–æ–≤.
- `utils/gsheets.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫, –ø–æ–∏—Å–∫/–ø–æ–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤, –ª–∏–º–∏—Ç 10 –≤–∞–∂–Ω—ã—Ö.

### Google Sheets
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å‚Äë–∞–∫–∫–∞—É–Ω—Ç Google. –í `.env` –∑–∞–¥–∞–π—Ç–µ `GOOGLE_SERVICE_ACCOUNT_JSON_PATH` –∫–∞–∫ –ø—É—Ç—å –∫ JSON‚Äë—Ñ–∞–π–ª—É –∫–ª—é—á–∞ –∏–ª–∏ —Å–∞–º JSON –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π. –î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ (Editor) –Ω–∞ e‚Äëmail —Å–µ—Ä–≤–∏—Å‚Äë–∞–∫–∫–∞—É–Ω—Ç–∞.
- **–¢–∞–±–ª–∏—Ü–∞**: –∑–∞–¥–∞—á–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç `Tasks` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `GSHEET_TASKS_WORKSHEET_NAME`). –ï—Å–ª–∏ –ª–∏—Å—Ç–∞ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ö–µ–º–æ–π –∫–æ–ª–æ–Ω–æ–∫: `–ü—Ä–æ–µ–∫—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç`. –í—Å–µ –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–æ–µ–∫—Ç "Calzen".
- **–ó–∞–ø–∏—Å—å**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤ –∏–Ω–ª–∞–π–Ω‚Äë–∫–Ω–æ–ø–∫–∞—Ö. –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏: –ü—Ä–æ–µ–∫—Ç (Calzen), –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
- **–õ–∏–º–∏—Ç 10**: –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ ¬´–≤–∞–∂–Ω—ã—Ö¬ª (`Critical|Blocker|High`) –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–Ω–∏–∂–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–¥–∞—á–∏ –¥–æ `Medium`.

**üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ**: [docs/google-sheets-setup.md](docs/google-sheets-setup.md)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)
- `raw_messages(id, chat_id, message_id, client_username, client_first_name, message_text, timestamp, is_processed)`
- `processed_tasks(id, chat_id, task_text, source_messages(JSON), processing_timestamp, created_date)`
- `staff_members(id, username UNIQUE, user_id UNIQUE)`
- –ò–Ω–¥–µ–∫—Å—ã: –ø–æ `chat_id`, `timestamp`, `is_processed`, `created_date`.

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
- –ï–∂–µ—á–∞—Å–Ω–∞—è –∑–∞–¥–∞—á–∞: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–∏–≤—à–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞.
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å –ø–æ —á–∞—Ç—É.
- `/process_now`: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Å–∞.
- `/parse <days>`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –¥–∏–∞–ø–∞–∑–æ–Ω `[now - days, now]`.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –õ–æ–≥–∏ ‚Äî –≤ stdout c —É—Ä–æ–≤–Ω—è–º–∏; Dockerfile —Å–æ–¥–µ—Ä–∂–∏—Ç healthcheck –¥–ª—è SQLite.
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ë–î ‚Äî volume –Ω–∞ `/app/data`.

### –ü—Ä–∏–º–µ—Ä—ã
```
/tasks
/tasks 2
/process_now
/parse 3
```


